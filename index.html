<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luy·ªán ƒê·ªÅ Online - H·ªá Th·ªëng Thi Tr·ª±c Tuy·∫øn</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="answer-modal.css">
    <!-- Mobile fix: hide auth-hero section -->
    <style>
        @media (max-width: 900px) {
            .auth-hero {
                display: none !important;
                width: 0 !important;
                visibility: hidden !important;
            }

            .auth-form-side {
                width: 100% !important;
                flex: 1 !important;
            }
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- KaTeX for LaTeX rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- html2canvas for LaTeX rendering in PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        // Preprocess LaTeX before KaTeX renders
        // Convert \vec to \overrightarrow for large vector arrows
        // Convert \frac to \dfrac for display-style fractions
        document.addEventListener('DOMContentLoaded', function () {
            function preprocessLatex(element) {
                if (element.innerHTML) {
                    element.innerHTML = element.innerHTML
                        .replace(/\\vec\{/g, '\\overrightarrow{')
                        .replace(/\\frac\{/g, '\\dfrac{');
                }
            }

            // Apply preprocessing to common content areas
            document.querySelectorAll('.question-text, .option-text, .answer-text, .exam-content').forEach(preprocessLatex);

            // Trigger KaTeX auto-render after preprocessing
            if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(document.body, {
                    delimiters: [
                        { left: '$$', right: '$$', display: true },
                        { left: '$', right: '$', display: false }
                    ]
                });
            }
        });

        // Also preprocess when new content is added dynamically
        window.preprocessAndRenderMath = function (container) {
            if (!container) container = document.body;

            // Preprocess LaTeX
            container.querySelectorAll('.question-text, .option-text, .answer-text, .exam-content, [data-latex]').forEach(function (el) {
                if (el.innerHTML) {
                    el.innerHTML = el.innerHTML
                        .replace(/\\vec\{/g, '\\overrightarrow{')
                        .replace(/\\frac\{/g, '\\dfrac{');
                }
            });

            // Also check the container itself
            if (container.innerHTML) {
                container.innerHTML = container.innerHTML
                    .replace(/\\vec\{/g, '\\overrightarrow{')
                    .replace(/\\frac\{/g, '\\dfrac{');
            }

            // Render with KaTeX
            if (typeof renderMathInElement !== 'undefined') {
                renderMathInElement(container, {
                    delimiters: [
                        { left: '$$', right: '$$', display: true },
                        { left: '$', right: '$', display: false }
                    ]
                });
            }
        };
    </script>
    <script>
        // reCAPTCHA config - must be defined before Google script loads
        var recaptchaWidgets = {};
        var RECAPTCHA_SITE_KEY = '6LcEjC0sAAAAACjs0nweyzv5PruiaaaFqHLLV7LL';

        function onRecaptchaLoad() {
            // Render login reCAPTCHA
            var loginContainer = document.getElementById('loginRecaptcha');
            if (loginContainer && recaptchaWidgets['loginForm'] === undefined) {
                recaptchaWidgets['loginForm'] = grecaptcha.render('loginRecaptcha', {
                    'sitekey': RECAPTCHA_SITE_KEY
                });
            }

            // Render register reCAPTCHA  
            var registerContainer = document.getElementById('registerRecaptcha');
            if (registerContainer && recaptchaWidgets['registerForm'] === undefined) {
                recaptchaWidgets['registerForm'] = grecaptcha.render('registerRecaptcha', {
                    'sitekey': RECAPTCHA_SITE_KEY
                });
            }
        }
    </script>
    <script src="https://www.google.com/recaptcha/api.js?onload=onRecaptchaLoad&render=explicit" async defer></script>
</head>

<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="screen">
        <div class="auth-layout">
            <!-- Left Side - Hero -->
            <div class="auth-hero">
                <div class="auth-hero-content">
                    <h1 class="auth-hero-title">Luy·ªán ƒê·ªÅ Online</h1>

                    <p class="auth-hero-desc">
                        Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi n·ªÅn t·∫£ng luy·ªán thi tr·ª±c tuy·∫øn h√†ng ƒë·∫ßu.
                        Chu·∫©n b·ªã cho k·ª≥ thi THPT Qu·ªëc gia, ƒê√°nh gi√° nƒÉng l·ª±c, ƒê√°nh gi√° t∆∞ duy v·ªõi h√†ng ng√†n ƒë·ªÅ thi ch·∫•t
                        l∆∞·ª£ng cao.
                    </p>

                    <div class="auth-features">
                        <div class="auth-feature">
                            <span class="feature-icon">‚è±Ô∏è</span>
                            <div>
                                <strong>B·ªô ƒë·∫øm th·ªùi gian ch√≠nh x√°c</strong>
                                <p>M√¥ ph·ªèng ƒëi·ªÅu ki·ªán thi th·∫≠t</p>
                            </div>
                        </div>
                        <div class="auth-feature">
                            <span class="feature-icon">‚úÖ</span>
                            <div>
                                <strong>Ch·∫•m ƒëi·ªÉm t·ª± ƒë·ªông</strong>
                                <p>Xem k·∫øt qu·∫£ v√† ƒë√°p √°n ngay l·∫≠p t·ª©c</p>
                            </div>
                        </div>
                        <div class="auth-feature">
                            <span class="feature-icon">üìö</span>
                            <div>
                                <strong>ƒê·ªÅ thi ƒëa d·∫°ng</strong>
                                <p>C·∫≠p nh·∫≠t li√™n t·ª•c t·ª´ c√°c chuy√™n gia</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Side - Form -->
            <div class="auth-form-side">
                <div class="auth-form-container">
                    <div class="auth-form-logo">
                        <img src="luyen_de_logo_white.svg" alt="Luy·ªán ƒê·ªÅ Online" style="height: 50px;">
                    </div>

                    <h2 class="auth-title">ƒêƒÉng nh·∫≠p</h2>
                    <p class="auth-subtitle">Nh·∫≠p th√¥ng tin ƒëƒÉng nh·∫≠p c·ªßa b·∫°n ƒë·ªÉ ti·∫øp t·ª•c</p>

                    <form id="loginForm" onsubmit="handleLogin(event)">
                        <div class="form-group">
                            <label for="loginUsername">T√™n ƒëƒÉng nh·∫≠p ho·∫∑c Email</label>
                            <input type="text" id="loginUsername" placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p ho·∫∑c email" required>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">M·∫≠t kh·∫©u</label>
                            <div class="input-with-icon">
                                <input type="password" id="loginPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" required>
                                <button type="button" class="toggle-password"
                                    onclick="togglePassword('loginPassword', this)">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                                        <circle cx="12" cy="12" r="3" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="form-row">
                            <label class="checkbox-label">
                                <input type="checkbox"> Ghi nh·ªõ ƒëƒÉng nh·∫≠p
                            </label>
                            <a href="#" class="forgot-link" onclick="showForgotPasswordContact(); return false;">Qu√™n
                                m·∫≠t kh·∫©u?</a>
                        </div>
                        <div class="form-group captcha-group">
                            <div class="g-recaptcha" data-sitekey="6LcEjC0sAAAAACjs0nweyzv5PruiaaaFqHLLV7LL"
                                id="loginRecaptcha"></div>
                        </div>
                        <button type="submit" class="btn btn-primary btn-large btn-full">ƒêƒÉng nh·∫≠p</button>
                    </form>

                    <p class="auth-switch">
                        Ch∆∞a c√≥ t√†i kho·∫£n? <a href="javascript:void(0)"
                            onclick="showScreen('registerScreen'); return false;">ƒêƒÉng k√Ω ngay</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Screen -->
    <div id="registerScreen" class="screen">
        <div class="auth-layout auth-layout-center">
            <div class="auth-form-side auth-form-full">
                <div class="auth-form-container auth-form-wide">
                    <div class="auth-form-logo">
                        <img src="luyen_de_logo_white.svg" alt="Luy·ªán ƒê·ªÅ Online" style="height: 50px;">
                    </div>

                    <h2 class="auth-title">ƒêƒÉng k√Ω t√†i kho·∫£n</h2>
                    <p class="auth-subtitle">T·∫°o t√†i kho·∫£n ƒë·ªÉ b·∫Øt ƒë·∫ßu luy·ªán ƒë·ªÅ</p>

                    <form id="registerForm" onsubmit="handleRegister(event)">
                        <div class="form-group">
                            <label for="registerName">H·ªç v√† t√™n</label>
                            <input type="text" id="registerName" placeholder="Nh·∫≠p h·ªç v√† t√™n" required>
                        </div>
                        <div class="form-group">
                            <label for="registerEmail">Email</label>
                            <input type="email" id="registerEmail" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ email" required>
                        </div>
                        <div class="form-group">
                            <label for="registerUsername">T√™n ƒëƒÉng nh·∫≠p</label>
                            <input type="text" id="registerUsername" placeholder="Ch·ªçn t√™n ƒëƒÉng nh·∫≠p" required>
                        </div>
                        <div class="form-group">
                            <label for="registerPassword">M·∫≠t kh·∫©u</label>
                            <div class="input-with-icon">
                                <input type="password" id="registerPassword" placeholder="T·∫°o m·∫≠t kh·∫©u" required>
                                <button type="button" class="toggle-password"
                                    onclick="togglePassword('registerPassword', this)">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                                        <circle cx="12" cy="12" r="3" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="registerPasswordConfirm">X√°c nh·∫≠n m·∫≠t kh·∫©u</label>
                            <div class="input-with-icon">
                                <input type="password" id="registerPasswordConfirm" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u"
                                    required>
                                <button type="button" class="toggle-password"
                                    onclick="togglePassword('registerPasswordConfirm', this)">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                                        <circle cx="12" cy="12" r="3" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="form-group captcha-group">
                            <div class="g-recaptcha" data-sitekey="6LcEjC0sAAAAACjs0nweyzv5PruiaaaFqHLLV7LL"
                                id="registerRecaptcha">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary btn-large btn-full">ƒêƒÉng k√Ω</button>
                    </form>

                    <p class="auth-switch">
                        ƒê√£ c√≥ t√†i kho·∫£n? <a href="#" onclick="showScreen('loginScreen')">ƒêƒÉng nh·∫≠p</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Screen (NEW DESIGN) -->
    <div id="dashboardScreen" class="screen">
        <div class="dashboard-container">
            <header class="dashboard-header">
                <div class="header-left">
                    <img src="luyen_de_logo_white.svg" alt="Luy·ªán ƒê·ªÅ Online" class="header-logo">
                </div>
                <div class="header-right">
                    <span class="user-name" id="dashboardUserName">Xin ch√†o, User</span>
                    <button class="btn btn-outline-sm" onclick="handleLogout()">ƒêƒÉng xu·∫•t</button>
                </div>
            </header>

            <main class="dashboard-main">
                <!-- Course Filter Tabs -->
                <div class="course-filter-tabs">
                    <button class="course-filter-tab active" data-filter="suggested"
                        onclick="switchCourseFilter('suggested')">
                        Kh√≥a h·ªçc g·ª£i √Ω
                    </button>
                    <button class="course-filter-tab" data-filter="enrolled" onclick="switchCourseFilter('enrolled')">
                        ƒêang h·ªçc (<span id="enrolledCount">0</span>)
                    </button>
                </div>

                <!-- Grade Tabs - Simple text without icons -->
                <div class="grade-tabs-simple">
                    <button class="grade-tab-simple active" data-grade="all" onclick="switchGradeTab('all')">T·∫•t
                        c·∫£</button>
                    <button class="grade-tab-simple" data-grade="10" onclick="switchGradeTab('10')">L·ªõp 10</button>
                    <button class="grade-tab-simple" data-grade="11" onclick="switchGradeTab('11')">L·ªõp 11</button>
                    <button class="grade-tab-simple" data-grade="12" onclick="switchGradeTab('12')">L·ªõp 12</button>
                    <button class="grade-tab-simple" data-grade="thpt" onclick="switchGradeTab('thpt')">THPT QG</button>
                </div>

                <!-- Subject Cards Grid -->
                <div class="subject-grid-section">
                    <h2 class="section-title" id="sectionTitle">Ch·ªçn m√¥n h·ªçc</h2>
                    <div class="subject-grid" id="subjectGrid">
                        <!-- Subject cards will be rendered here by JS -->
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Exam List Screen (REDESIGNED) -->
    <div id="examListScreen" class="screen">
        <div class="exam-list-container">
            <header class="dashboard-header">
                <div class="header-left">
                    <button class="back-btn" onclick="showDashboard()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <img src="luyen_de_logo_white.svg" alt="Luy·ªán ƒê·ªÅ Online" class="header-logo clickable"
                        onclick="showDashboard()" title="V·ªÅ trang ch·ªß">
                </div>
                <div class="header-right">
                    <span class="user-name" id="examListUserName">Xin ch√†o, User</span>
                    <button class="btn btn-outline-sm" onclick="handleLogout()">ƒêƒÉng xu·∫•t</button>
                </div>
            </header>

            <main class="exam-list-main">
                <!-- Subject Header -->
                <div class="subject-header" id="subjectHeader">
                    <span class="subject-icon" id="subjectIconDisplay">üìê</span>
                    <div class="subject-info">
                        <h1 class="exam-list-title" id="examListTitle">To√°n - L·ªõp 12</h1>
                        <span class="exam-count" id="examCount">15 ƒë·ªÅ thi</span>
                    </div>
                </div>

                <!-- Semester Tabs (only for grade 10/11/12) -->
                <div class="semester-tabs" id="semesterTabs">
                    <button class="semester-tab active" data-semester="all" onclick="filterBySemester('all')">T·∫•t
                        c·∫£</button>
                    <button class="semester-tab" data-semester="gk1" onclick="filterBySemester('gk1')">Gi·ªØa k√¨
                        1</button>
                    <button class="semester-tab" data-semester="ck1" onclick="filterBySemester('ck1')">Cu·ªëi k√¨
                        1</button>
                    <button class="semester-tab" data-semester="gk2" onclick="filterBySemester('gk2')">Gi·ªØa k√¨
                        2</button>
                    <button class="semester-tab" data-semester="ck2" onclick="filterBySemester('ck2')">Cu·ªëi k√¨
                        2</button>
                </div>

                <!-- Tab navigation for exam list -->
                <div class="tab-navigation">
                    <button class="tab-btn active" onclick="switchExamTab('exams')">ƒê·ªÅ thi</button>
                    <button class="tab-btn" onclick="switchExamTab('history')">L·ªãch s·ª≠ l√†m b√†i</button>
                </div>

                <!-- Tab content: ƒê·ªÅ thi -->
                <div class="tab-content active" id="examsTab">
                    <div class="exam-grid-new" id="examGrid">
                        <!-- Exams will be rendered here -->
                    </div>
                </div>

                <!-- Tab content: L·ªãch s·ª≠ l√†m b√†i -->
                <div class="tab-content" id="historyTab">
                    <div class="history-list" id="historyList">
                        <!-- Exam history will be rendered here -->
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Pre-Exam Screen -->
    <div id="preExamScreen" class="screen">
        <div class="container">
            <div class="card pre-exam-card">
                <div class="logo-container">
                    <img src="luyen_de_logo_white.svg" alt="Luy·ªán ƒê·ªÅ Online" style="height: 60px;">
                </div>

                <h2 class="pre-exam-title">X√°c nh·∫≠n th√¥ng tin d·ª± thi</h2>

                <div class="info-table" style="margin-bottom: 24px; text-align: left;">
                    <p style="margin: 8px 0; font-size: 15px;"><span style="color: #666;">H·ªç t√™n: </span><strong
                            id="preStudentName" style="color: #333;">PH·∫†M ƒê·ª®C TH·∫ÆNG</strong></p>
                    <p style="margin: 8px 0; font-size: 15px;"><span style="color: #666;">T√™n ƒë·ªÅ thi: </span><strong
                            id="preExamTitle" style="color: #333;">ƒë·ªÅ s·ªë 1 kh√≥a TSA</strong></p>
                </div>

                <p class="warning-text">
                    <em>L∆∞u √Ω: B·∫±ng vi·ªác nh·∫•n n√∫t "B·∫Øt ƒë·∫ßu thi" h·ªá th·ªëng s·∫Ω b·∫Øt ƒë·∫ßu t√≠nh gi·ªù cho b√†i thi c·ªßa b·∫°n</em>
                </p>

                <!-- Loading bar -->
                <div class="loading-container" id="loadingContainer" style="display: none;">
                    <div class="loading-bar">
                        <div class="loading-progress" id="loadingProgress"></div>
                    </div>
                    <p class="loading-text">ƒêang ki·ªÉm tra th√¥ng tin b√†i thi ...</p>
                </div>

                <button class="btn btn-primary btn-large" id="startExamBtn" onclick="startExamWithLoading()">B·∫Øt ƒë·∫ßu
                    thi</button>

                <a href="#" class="link-back-left" onclick="backToExamList(); return false;">Quay l·∫°i</a>
            </div>
        </div>
    </div>

    <!-- In-Exam Screen -->
    <div id="examScreen" class="screen">
        <div class="exam-content">
            <!-- Left: Question Area with Header -->
            <div class="question-section">
                <div class="question-header-bar">
                    <div class="logo-header">
                        <img src="luyen_de_logo_white.svg" alt="Luy·ªán ƒê·ªÅ Online" style="height: 36px;">
                    </div>
                    <span class="exam-title" id="examTitleHeader">ƒë·ªÅ s·ªë 1 kh√≥a TSA</span>

                    <!-- Hamburger menu for mobile -->
                    <button class="hamburger-btn" id="hamburgerBtn" onclick="toggleSidebar()">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                </div>

                <div class="question-scroll-wrapper">
                    <div class="question-content">
                        <div class="question-header-row">
                            <span class="question-number-badge" id="questionNumber">1</span>
                            <div class="question-text" id="questionText">
                                Ch·ªâ ra c√¢u ƒë√∫ng, c√¢u sai trong nh·ªØng m·ªánh ƒë·ªÅ d∆∞·ªõi ƒë√¢y:
                            </div>
                            <button class="btn-flag" id="flagBtn" onclick="toggleFlag()"
                                data-tooltip="ƒê√°nh d·∫•u c√¢u ch∆∞a ch·∫Øc ch·∫Øn">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M17 3H7C5.9 3 5 3.9 5 5V21L12 18L19 21V5C19 3.9 18.1 3 17 3ZM17 18L12 15.82L7 18V5H17V18Z"
                                        fill="currentColor" />
                                </svg>
                            </button>
                        </div>

                        <div class="answers-grid" id="answersContainer">
                            <!-- Answers will be dynamically generated -->
                        </div>
                    </div>
                </div>

                <div class="navigation-buttons">
                    <button type="button" class="btn btn-icon" id="prevBtn" onclick="navigateQuestion(-1)"
                        title="C√¢u tr∆∞·ªõc">
                        <svg width="16" height="16" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8 10L4 6L8 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                    </button>
                    <button type="button" class="btn btn-primary" id="nextBtn" onclick="navigateQuestion(1)">
                        C√¢u ti·∫øp <svg width="16" height="16" viewBox="0 0 12 12" fill="none"
                            xmlns="http://www.w3.org/2000/svg" style="margin-left: 4px;">
                            <path d="M4 2L8 6L4 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </svg>
                    </button>
                    <span class="time-hint">Th·ªùi gian l√†m c√¢u hi·ªán t·∫°i</span>
                    <span class="time-hint-time" id="questionTime">0:00</span>
                </div>
            </div>

            <!-- Overlay for mobile sidebar -->
            <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

            <!-- Right: Full-Height Sidebar -->
            <div class="sidebar" id="examSidebar">
                <div class="sidebar-header">
                    <h4>Th√¥ng tin th√≠ sinh</h4>
                    <!-- Close button for mobile -->
                    <button class="sidebar-close-btn" onclick="toggleSidebar()">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                </div>

                <div class="sidebar-info">
                    <div class="info-row-small">
                        <span class="label">H·ªç t√™n</span>
                        <span class="value" id="sidebarStudentName">PH·∫†M ƒê·ª®C TH·∫ÆNG</span>
                    </div>
                    <div class="info-row-small">
                        <span class="label">M√£ ph√≤ng thi</span>
                        <span class="value" id="sidebarExamId">---</span>
                    </div>
                </div>

                <div class="timer-submit-row">
                    <div class="timer-box">
                        <span class="timer-label">Th·ªùi gian c√≤n l·∫°i</span>
                        <span class="timer-value" id="timerSidebar">60:00</span>
                    </div>
                    <div class="submit-box">
                        <button class="btn-submit-sidebar" onclick="confirmSubmit()">N·ªôp b√†i</button>
                    </div>
                </div>

                <div class="grid-scroll-wrapper" id="gridScrollWrapper">
                    <div class="color-indicators">
                        <div class="indicator-header">
                            <span class="indicator-label">Ch·ªâ th·ªã m√†u s·∫Øc:</span>
                            <div class="indicator-badges">
                                <span class="badge badge-gray" id="unansweredCount"
                                    data-tooltip="C√¢u ch∆∞a tr·∫£ l·ªùi">40</span>
                                <span class="badge badge-blue" id="answeredBadge" data-tooltip="C√¢u ƒë√£ tr·∫£ l·ªùi">0</span>
                                <span class="badge badge-orange" id="flaggedBadge"
                                    data-tooltip="C√¢u ch∆∞a ch·∫Øc ch·∫Øn">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-grid" id="questionGrid">
                        <!-- Grid items will be dynamically generated -->
                    </div>
                </div>

                <div class="status-legend">
                    <div class="progress-section">
                        <span class="progress-text">B·∫°n ƒë√£ ho√†n th√†nh</span>
                        <span><span class="progress-count" id="answeredCount">0</span><span
                                class="progress-count">/40</span><span class="progress-count-small"> c√¢u</span></span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progressBar">
                            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                        </div>
                        <span class="progress-percentage" id="progressPercentage">0%</span>
                    </div>
                    <div class="connection-status" id="connectionStatus">
                        <div class="status-dot" id="statusDot"></div>
                        <span id="connectionText">ƒê√£ k·∫øt n·ªëi m√°y ch·ªß</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Result Screen -->
    <div id="resultScreen" class="screen">
        <div class="container">
            <div class="card result-card">
                <div class="logo-container">
                    <img src="luyen_de_logo_white.svg" alt="Luy·ªán ƒê·ªÅ Online" style="height: 60px;">
                </div>

                <h2 class="result-title">Th√¥ng tin b√†i thi</h2>

                <div class="info-table" style="margin-bottom: 24px; text-align: left;">
                    <p style="margin: 8px 0; font-size: 15px;"><span style="color: #666;">H·ªç t√™n: </span><strong
                            id="resultStudentName" style="color: #333;">PH·∫†M ƒê·ª®C TH·∫ÆNG</strong></p>
                    <p style="margin: 8px 0; font-size: 15px;"><span style="color: #666;">K√≠p thi: </span><strong
                            id="resultExamTitle" style="color: #333;">ƒë·ªÅ s·ªë 1 kh√≥a TSA</strong></p>
                    <p style="margin: 8px 0; font-size: 15px;"><span style="color: #666;">Th·ªùi gian: </span><strong
                            id="examDuration" style="color: #333;">60 ph√∫t</strong></p>
                    <p style="margin: 8px 0; font-size: 15px;"><span style="color: #666;">Th·ªùi gian l√†m b√†i th·ª±c t·∫ø:
                        </span><strong id="actualTime" style="color: #333;">00:02:56</strong></p>
                    <p style="margin: 8px 0; font-size: 15px;"><span style="color: #666;">S·ªë c√¢u tr·∫Øc nghi·ªám ƒë√∫ng:
                        </span><strong style="color: #333;"><span id="correctAnswers">10</span>/40</strong></p>
                    <p style="margin: 8px 0; font-size: 15px;"><span style="color: #666;">ƒêi·ªÉm s·ªë: </span><strong
                            id="finalScore" class="score" style="color: #333;">2.5/10</strong></p>
                </div>

                <a href="#" class="link-back-left" onclick="backToExamList()">V·ªÅ danh s√°ch ƒë·ªÅ</a>
            </div>
        </div>
    </div>

    <!-- Answer Review Screen -->
    <div id="answerReviewScreen" class="screen">
        <div class="answer-review-container">
            <header class="dashboard-header">
                <div class="header-left">
                    <img src="luyen_de_logo_white.svg" alt="Luy·ªán ƒê·ªÅ Online" class="header-logo clickable"
                        onclick="showScreen('examListScreen')" title="Quay l·∫°i">
                </div>
                <div class="header-right">
                    <span class="user-name" id="reviewUserName">Xin ch√†o, User</span>
                    <button class="btn btn-outline-sm" onclick="handleLogout()">ƒêƒÉng xu·∫•t</button>
                </div>
            </header>

            <main class="answer-review-main">
                <div class="review-header">
                    <h1 class="review-title" id="reviewTitle">Xem ƒë√°p √°n</h1>
                    <div class="review-info">
                        <span class="review-score" id="reviewScore">ƒêi·ªÉm: 8.5/10</span>
                        <span class="review-date" id="reviewDate">Ng√†y l√†m: 15/12/2025</span>
                    </div>
                </div>

                <div class="review-questions" id="reviewQuestions">
                    <!-- Questions with answers will be rendered here -->
                </div>

                <div class="review-footer">
                    <button class="btn btn-primary" onclick="backToExamList()">Quay l·∫°i danh s√°ch
                        ƒë·ªÅ</button>
                </div>
            </main>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <div class="modal-progress-circle">
                <span class="progress-text" id="modalProgressText">0/40</span>
                <span class="progress-label">c√¢u</span>
            </div>
            <p class="modal-message">ƒê√£ tr·∫£ l·ªùi <span id="modalAnsweredCount">0</span>/40 c√¢u. B·∫°n v·∫´n c√≤n th·ªùi gian l√†m
                b√†i, b·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën k·∫øt th√∫c b√†i thi.</p>
            <div class="modal-buttons">
                <button class="btn btn-modal-secondary" onclick="closeModal()">L√†m b√†i ti·∫øp</button>
                <button class="btn btn-modal-primary" onclick="submitExam()">N·ªôp b√†i thi</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Tooltip - runs after DOM ready
        (function () {
            var tip = document.createElement('div');
            tip.style.cssText = 'position:fixed;background:#333;color:#fff;padding:6px 12px;border-radius:6px;font-size:12px;pointer-events:none;opacity:0;transition:opacity 0.15s;z-index:99999;white-space:nowrap;';

            var textSpan = document.createElement('span');
            tip.appendChild(textSpan);

            var arrow = document.createElement('div');
            arrow.style.cssText = 'position:absolute;bottom:-6px;left:50%;margin-left:-6px;border-left:6px solid transparent;border-right:6px solid transparent;border-top:6px solid #333;';
            tip.appendChild(arrow);

            document.body.appendChild(tip);

            document.addEventListener('mouseover', function (e) {
                var el = e.target;
                while (el && !el.getAttribute('data-tooltip')) {
                    el = el.parentElement;
                }
                if (el) {
                    textSpan.textContent = el.getAttribute('data-tooltip');
                    var rect = el.getBoundingClientRect();
                    tip.style.opacity = '1';
                    setTimeout(function () {
                        tip.style.left = (rect.left + rect.width / 2 - tip.offsetWidth / 2) + 'px';
                        tip.style.top = (rect.top - tip.offsetHeight - 8) + 'px';
                    }, 0);
                }
            });

            document.addEventListener('mouseout', function (e) {
                var el = e.target;
                while (el && !el.getAttribute('data-tooltip')) {
                    el = el.parentElement;
                }
                if (el) {
                    tip.style.opacity = '0';
                }
            });
        })();
    </script>

    <!-- Exam Security disabled for testing -->

    <!-- Contact Modal for Package Registration -->
    <div id="contactModal" class="modal">
        <div class="modal-content contact-modal">
            <div class="modal-header">
                <h3>üìû Li√™n h·ªá ƒëƒÉng k√Ω g√≥i</h3>
                <button class="modal-close" onclick="closeContactModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 16px; color: #475569;">
                    ƒê·ªÉ ƒëƒÉng k√Ω g√≥i luy·ªán ƒë·ªÅ n√†y, vui l√≤ng li√™n h·ªá admin qua m·ªôt trong c√°c k√™nh sau:
                </p>
                <div class="contact-options">
                    <a href="#" class="contact-option zalo" target="_blank">
                        <span class="contact-icon"
                            style="background: #0068ff; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                            <svg viewBox="0 0 24 24" width="24" height="24" fill="white">
                                <path
                                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h2v-2h-2v2zm0-4h2V7h-2v6z" />
                                <text x="6" y="16" font-size="10" font-weight="bold" fill="white">Z</text>
                            </svg>
                        </span>
                        <span class="contact-name">Zalo</span>
                        <span class="contact-desc">Nh·∫Øn tin qua Zalo</span>
                    </a>
                    <a href="#" class="contact-option facebook" target="_blank">
                        <span class="contact-icon">
                            <svg viewBox="0 0 48 48" width="28" height="28">
                                <path fill="#3F51B5"
                                    d="M42,37c0,2.762-2.238,5-5,5H11c-2.761,0-5-2.238-5-5V11c0-2.762,2.239-5,5-5h26c2.762,0,5,2.238,5,5V37z" />
                                <path fill="#FFF"
                                    d="M34.368,25H31v13h-5V25h-3v-4h3v-2.41c0.002-3.508,1.459-5.59,5.592-5.59H35v4h-2.287C31.104,17,31,17.6,31,18.723V21h4L34.368,25z" />
                            </svg>
                        </span>
                        <span class="contact-name">Facebook</span>
                        <span class="contact-desc">Li√™n h·ªá qua Facebook</span>
                    </a>
                    <a href="#" class="contact-option telegram" target="_blank">
                        <span class="contact-icon">
                            <svg viewBox="0 0 48 48" width="28" height="28">
                                <path fill="#29b6f6" d="M24 4A20 20 0 1 0 24 44A20 20 0 1 0 24 4Z" />
                                <path fill="#fff"
                                    d="M33.95,15l-3.746,19.126c0,0-0.161,0.874-1.245,0.874c-0.576,0-0.873-0.274-0.873-0.274l-8.114-6.733 l-3.97-2.001l-5.095-1.355c0,0-0.907-0.262-0.907-1.012c0-0.625,0.933-0.923,0.933-0.923l21.316-8.468 c-0.001-0.001,0.651-0.235,1.126-0.234C33.667,14,34,14.125,34,14.5C34,14.75,33.95,15,33.95,15z" />
                                <path fill="#b0bec5"
                                    d="M23,30.505l-3.426,3.374c0,0-0.149,0.115-0.348,0.12c-0.069,0.002-0.143-0.009-0.219-0.043 l0.964-5.965L23,30.505z" />
                                <path fill="#cfd8dc"
                                    d="M29.897,18.196c-0.169-0.22-0.481-0.26-0.701-0.093L16,26c0,0,2.106,5.892,2.427,6.912 c0.322,1.021,0.58,1.045,0.58,1.045l0.964-5.965l9.832-9.096C30.023,18.729,30.064,18.416,29.897,18.196z" />
                            </svg>
                        </span>
                        <span class="contact-name">Telegram</span>
                        <span class="contact-desc">Nh·∫Øn tin Telegram</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <!-- Exam Mode Selection Modal -->
    <div id="examModeModal" class="modal">
        <div class="modal-content exam-mode-modal-large">
            <div class="modal-header">
                <h3 id="examModeTitle">üìù Ch·ªçn ch·∫ø ƒë·ªô l√†m b√†i</h3>
                <button class="modal-close" onclick="closeExamModeModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <p class="exam-mode-desc" id="examModeDesc">ƒê·ªÅ thi: ...</p>
                <div class="exam-mode-grid">
                    <button class="exam-mode-card online" onclick="startOnlineMode()">
                        <span class="mode-icon">üíª</span>
                        <span class="mode-name">L√†m online</span>
                        <span class="mode-desc">L√†m b√†i tr·ª±c ti·∫øp tr√™n web</span>
                    </button>
                    <button class="exam-mode-card form" onclick="startFormMode()">
                        <span class="mode-icon">üìã</span>
                        <span class="mode-name">ƒêi·ªÅn form</span>
                        <span class="mode-desc">Phi·∫øu tr·∫£ l·ªùi tr·∫Øc nghi·ªám</span>
                    </button>
                    <button class="exam-mode-card preview" onclick="previewPDFMode()">
                        <span class="mode-icon">üëÅÔ∏è</span>
                        <span class="mode-name">Xem tr∆∞·ªõc PDF</span>
                        <span class="mode-desc">Xem ƒë·ªÅ thi d·∫°ng PDF</span>
                    </button>
                    <button class="exam-mode-card print" onclick="printExamMode()">
                        <span class="mode-icon">üì•</span>
                        <span class="mode-name">T·∫£i PDF</span>
                        <span class="mode-desc">T·∫£i file PDF v·ªÅ m√°y</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bubble Sheet Modal -->
    <div id="bubbleSheetModal" class="modal bubble-sheet-modal">
        <div class="modal-content bubble-sheet-content">
            <div class="modal-header">
                <h3>üìã Phi·∫øu tr·∫£ l·ªùi tr·∫Øc nghi·ªám</h3>
                <button class="modal-close" onclick="closeBubbleSheet()">‚úï</button>
            </div>
            <div id="bubbleSheetContainer">
                <!-- Bubble sheet will be rendered here -->
            </div>
        </div>
    </div>

    <script src="api.js"></script>
    <script src="vietnamese-font.js"></script>
    <script src="exam-pdf.js"></script>
    <script src="bubble-sheet.js"></script>
    <script src="script.js"></script>
</body>

</html>