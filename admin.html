<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Luy·ªán ƒê·ªÅ Online</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="admin.css">
    <!-- TinyMCE CDN -->
    <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
    <!-- MathJax for LaTeX rendering -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
    <!-- Admin Login Screen -->
    <div id="adminLoginScreen" class="screen active">
        <div class="auth-container auth-layout-center">
            <div class="auth-form-side auth-form-full">
                <div class="auth-form-card auth-form-wide">
                    <div class="logo-text">
                        <div class="logo-brand">
                            <span class="logo-main">LUY·ªÜN ƒê·ªÄ</span>
                            <span class="logo-sub">ADMIN</span>
                        </div>
                    </div>

                    <h1 class="auth-title">ƒêƒÉng nh·∫≠p Admin</h1>
                    <p class="auth-subtitle">Qu·∫£n l√Ω h·ªá th·ªëng Luy·ªán ƒê·ªÅ Online</p>

                    <form id="adminLoginForm" onsubmit="handleAdminLogin(event)">
                        <div class="form-group">
                            <label for="adminUsername">T√™n ƒëƒÉng nh·∫≠p</label>
                            <input type="text" id="adminUsername" placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p" required>
                        </div>
                        <div class="form-group">
                            <label for="adminPassword">M·∫≠t kh·∫©u</label>
                            <div class="input-with-icon">
                                <input type="password" id="adminPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary btn-large btn-full">ƒêƒÉng nh·∫≠p</button>
                    </form>

                    <p class="auth-switch">
                        <a href="index.html">‚Üê V·ªÅ trang Student Portal</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="screen">
        <div class="admin-layout">
            <!-- Sidebar -->
            <aside class="admin-sidebar">
                <div class="admin-sidebar-header">
                    <div class="admin-logo">
                        <span class="logo-main">LUY·ªÜN ƒê·ªÄ</span>
                        <span class="logo-sub">ADMIN</span>
                    </div>
                </div>

                <nav class="admin-nav">
                    <button class="admin-nav-item active" onclick="showAdminTab('dashboard')">
                        <span class="nav-icon">üìä</span>
                        <span class="nav-text">Dashboard</span>
                    </button>
                    <button class="admin-nav-item" onclick="showAdminTab('users')">
                        <span class="nav-icon">üë•</span>
                        <span class="nav-text">Qu·∫£n l√Ω Users</span>
                    </button>
                    <button class="admin-nav-item" onclick="showAdminTab('packages')">
                        <span class="nav-icon">üì¶</span>
                        <span class="nav-text">Qu·∫£n l√Ω G√≥i ƒë·ªÅ</span>
                    </button>
                    <button class="admin-nav-item" onclick="showAdminTab('exams')">
                        <span class="nav-icon">üìù</span>
                        <span class="nav-text">Qu·∫£n l√Ω ƒê·ªÅ thi</span>
                    </button>
                    <button class="admin-nav-item" onclick="showAdminTab('history')">
                        <span class="nav-icon">üìã</span>
                        <span class="nav-text">L·ªãch s·ª≠ l√†m b√†i</span>
                    </button>
                    <button class="admin-nav-item" onclick="showAdminTab('admins')">
                        <span class="nav-icon">üîê</span>
                        <span class="nav-text">Qu·∫£n l√Ω Admins</span>
                    </button>
                    <button class="admin-nav-item" onclick="showAdminTab('settings')">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        <span class="nav-text">C√†i ƒë·∫∑t</span>
                    </button>
                </nav>

                <div class="admin-sidebar-footer">
                    <div class="admin-user-info">
                        <span class="admin-name" id="currentAdminName">Admin</span>
                        <span class="admin-role" id="currentAdminRole">Super Admin</span>
                    </div>
                    <button class="btn-logout" onclick="handleAdminLogout()">ƒêƒÉng xu·∫•t</button>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="admin-main">
                <!-- Dashboard Tab -->
                <div class="admin-tab active" id="dashboardTab">
                    <div class="admin-header">
                        <h1>Dashboard</h1>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üë•</div>
                            <div class="stat-info">
                                <span class="stat-value" id="totalUsers">0</span>
                                <span class="stat-label">Ng∆∞·ªùi d√πng</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üì¶</div>
                            <div class="stat-info">
                                <span class="stat-value" id="totalPackages">0</span>
                                <span class="stat-label">G√≥i ƒë·ªÅ</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìù</div>
                            <div class="stat-info">
                                <span class="stat-value" id="totalExams">0</span>
                                <span class="stat-label">ƒê·ªÅ thi</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">‚úÖ</div>
                            <div class="stat-info">
                                <span class="stat-value" id="totalAttempts">0</span>
                                <span class="stat-label">L∆∞·ª£t thi</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Users Tab -->
                <div class="admin-tab" id="usersTab">
                    <div class="admin-header">
                        <h1>Qu·∫£n l√Ω Users</h1>
                        <div class="search-box">
                            <input type="text" id="userSearchInput" placeholder="T√¨m theo username ho·∫∑c email..."
                                oninput="filterUsers()">
                            <button class="btn btn-secondary" onclick="clearUserSearch()">X√≥a</button>
                        </div>
                    </div>
                    <div class="admin-table-container">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>H·ªç t√™n</th>
                                    <th>Email</th>
                                    <th>Username</th>
                                    <th>Ng√†y ƒëƒÉng k√Ω</th>
                                    <th>G√≥i ƒë√£ k√≠ch ho·∫°t</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <!-- Users will be rendered here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Packages Tab -->
                <div class="admin-tab" id="packagesTab">
                    <div class="admin-header">
                        <h1>Qu·∫£n l√Ω G√≥i ƒë·ªÅ</h1>
                        <button class="btn btn-primary" onclick="showPackageModal()">+ T·∫°o g√≥i m·ªõi</button>
                    </div>
                    <div class="packages-grid" id="adminPackagesGrid">
                        <!-- Packages will be rendered here -->
                    </div>
                </div>

                <!-- Exams Tab -->
                <div class="admin-tab" id="examsTab">
                    <div class="admin-header">
                        <h1 id="examTabTitle">Qu·∫£n l√Ω ƒê·ªÅ thi</h1>
                        <button class="btn btn-primary" id="btnCreateExam" onclick="showExamCreator()">+ T·∫°o ƒë·ªÅ
                            m·ªõi</button>
                        <button class="btn btn-secondary" id="btnBackToExamList" onclick="showExamList()"
                            style="display: none;">‚Üê Quay l·∫°i danh s√°ch</button>
                    </div>

                    <!-- Exam List View -->
                    <div id="examListView">
                        <div class="admin-table-container">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>T√™n ƒë·ªÅ thi</th>
                                        <th>G√≥i ƒë·ªÅ</th>
                                        <th>Ng√†y t·∫°o</th>
                                        <th>Ng∆∞·ªùi t·∫°o</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="examsTableBody">
                                    <!-- Exams will be rendered here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Exam Creator View -->
                    <div id="examCreatorView" class="exam-creator" style="display: none;">
                        <input type="hidden" id="editingExamId">

                        <!-- Action Buttons Header (like Khaothi) -->
                        <div class="exam-action-bar">
                            <div class="exam-action-left">
                                <button type="button" class="btn btn-secondary" onclick="showExamList()">
                                    ‚Üê Quay l·∫°i
                                </button>
                            </div>
                            <div class="exam-action-right">
                                <button type="button" class="btn btn-outline" onclick="previewExam()">
                                    üëÅ Xem tr∆∞·ªõc
                                </button>
                                <button type="button" class="btn btn-primary" onclick="saveExam()">
                                    üíæ L∆∞u
                                </button>
                                <button type="button" class="btn btn-success" onclick="saveExamAndNew()">
                                    üíæ L∆∞u & Th√™m m·ªõi
                                </button>
                            </div>
                        </div>

                        <!-- Exam Info Header -->
                        <div class="exam-creator-header">
                            <div class="form-group">
                                <label>Ch·ªçn g√≥i ƒë·ªÅ</label>
                                <select id="examPackageSelect" class="form-select">
                                    <!-- Packages will be populated here -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label>T√™n ƒë·ªÅ thi</label>
                                <input type="text" id="examTitle" placeholder="VD: ƒê·ªÅ s·ªë 1 - Gi·ªØa k√¨ 2"
                                    class="form-input">
                            </div>
                            <div class="form-group">
                                <label>M√£ m√¥n (Tag)</label>
                                <input type="text" id="examTag" placeholder="VD: THPT To√°n" class="form-input">
                            </div>
                            <div class="form-group">
                                <label>Tr·∫°ng th√°i</label>
                                <select id="examStatus" class="form-select">
                                    <option value="draft">ƒêang so·∫°n (·∫®n)</option>
                                    <option value="published">ƒê√£ xu·∫•t b·∫£n (Cho thi)</option>
                                    <option value="view_only">Ch·ªâ xem (Kh√¥ng cho thi)</option>
                                    <option value="updating">ƒêang c·∫≠p nh·∫≠t</option>
                                </select>
                            </div>
                        </div>

                        <!-- Part I: Multiple Choice -->
                        <div class="exam-section">
                            <h3>Ph·∫ßn I: Tr·∫Øc nghi·ªám (12 c√¢u - 0.25ƒë/c√¢u)</h3>
                            <div id="mcQuestions">
                                <!-- MC questions will be rendered here -->
                            </div>
                        </div>

                        <!-- Part II: True/False -->
                        <div class="exam-section">
                            <h3>Ph·∫ßn II: ƒê√∫ng/Sai (4 c√¢u - l≈©y ti·∫øn t·ªëi ƒëa 1ƒë/c√¢u)</h3>
                            <div id="tfQuestions">
                                <!-- TF questions will be rendered here -->
                            </div>
                        </div>

                        <!-- Part III: Fill-in-blank -->
                        <div class="exam-section">
                            <h3>Ph·∫ßn III: Tr·∫£ l·ªùi ng·∫Øn (6 c√¢u - 0.5ƒë/c√¢u)</h3>
                            <div id="fillQuestions">
                                <!-- Fill questions will be rendered here -->
                            </div>
                        </div>

                        <div class="exam-creator-footer">
                            <button class="btn btn-primary btn-large" onclick="saveExam()">üíæ L∆∞u ƒë·ªÅ thi</button>
                        </div>
                    </div>
                </div>

                <!-- History Tab -->
                <div class="admin-tab" id="historyTab">
                    <div class="admin-header">
                        <h1>L·ªãch s·ª≠ l√†m b√†i</h1>
                        <div class="search-box">
                            <input type="text" id="historySearchInput" placeholder="T√¨m theo t√™n ho·∫∑c username..."
                                oninput="filterHistory()">
                            <select id="historyPackageFilter" onchange="filterHistory()">
                                <option value="">T·∫•t c·∫£ g√≥i ƒë·ªÅ</option>
                            </select>
                            <button class="btn btn-secondary" onclick="clearHistorySearch()">X√≥a</button>
                        </div>
                    </div>
                    <div class="admin-table-container">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>H·ªçc sinh</th>
                                    <th>G√≥i ƒë·ªÅ</th>
                                    <th>T√™n ƒë·ªÅ</th>
                                    <th>ƒêi·ªÉm</th>
                                    <th>Th·ªùi gian l√†m</th>
                                    <th>Ng√†y l√†m</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="historyTableBody">
                                <!-- History will be rendered here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Admins Tab -->
                <div class="admin-tab" id="adminsTab">
                    <div class="admin-header">
                        <h1>Qu·∫£n l√Ω Admins</h1>
                        <button class="btn btn-primary" onclick="showAdminModal()">+ Th√™m Admin</button>
                    </div>
                    <div class="admin-table-container">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>T√™n</th>
                                    <th>Username</th>
                                    <th>Vai tr√≤</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="adminsTableBody">
                                <!-- Admins will be rendered here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div class="admin-tab" id="settingsTab">
                    <div class="admin-header">
                        <h1>‚öôÔ∏è C√†i ƒë·∫∑t</h1>
                    </div>
                    <div class="settings-section">
                        <h3>üìû Th√¥ng tin li√™n h·ªá</h3>
                        <p class="settings-desc">C√°c link n√†y s·∫Ω hi·ªÉn th·ªã trong modal li√™n h·ªá khi h·ªçc sinh mu·ªën ƒëƒÉng k√Ω
                            g√≥i.</p>
                        <form id="contactSettingsForm" onsubmit="saveContactSettings(event)">
                            <div class="form-group">
                                <label>Link Zalo</label>
                                <input type="text" id="contactZalo" placeholder="https://zalo.me/your_id">
                            </div>
                            <div class="form-group">
                                <label>Link Facebook</label>
                                <input type="text" id="contactFacebook" placeholder="https://m.me/your_page">
                            </div>
                            <div class="form-group">
                                <label>Link Telegram</label>
                                <input type="text" id="contactTelegram" placeholder="https://t.me/your_username">
                            </div>
                            <button type="submit" class="btn btn-primary">L∆∞u c√†i ƒë·∫∑t</button>
                        </form>
                    </div>

                    <div class="settings-section" style="margin-top: 24px;">
                        <h3>üß™ D·ªØ li·ªáu test</h3>
                        <p class="settings-desc">T·∫°o t√†i kho·∫£n h·ªçc sinh m·∫´u ƒë·ªÉ ki·ªÉm tra giao di·ªán.</p>
                        <button type="button" class="btn btn-secondary" onclick="createTestUser()">T·∫°o h·ªçc sinh
                            test</button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Package Modal -->
    <div id="packageModal" class="modal">
        <div class="modal-content modal-form">
            <button class="modal-close" onclick="closePackageModal()">&times;</button>
            <h2>T·∫°o g√≥i ƒë·ªÅ m·ªõi</h2>
            <form id="packageForm" onsubmit="savePackage(event)">
                <div class="form-group">
                    <label>T√™n g√≥i ƒë·ªÅ</label>
                    <input type="text" id="packageName" placeholder="VD: ƒê·ªÅ thi gi·ªØa k√¨ 2 l·ªõp 12" required>
                </div>
                <div class="form-group">
                    <label>M√¥ t·∫£</label>
                    <textarea id="packageDesc" rows="3" placeholder="M√¥ t·∫£ ng·∫Øn v·ªÅ g√≥i ƒë·ªÅ"></textarea>
                </div>
                <div class="form-row-2">
                    <div class="form-group">
                        <label>Icon (emoji)</label>
                        <input type="text" id="packageIcon" value="üìù" maxlength="2">
                    </div>
                    <div class="form-group">
                        <label>Th·ªùi l∆∞·ª£ng (ph√∫t)</label>
                        <input type="number" id="packageDuration" value="90" min="1">
                    </div>
                </div>
                <div class="form-group">
                    <label>Tr·∫°ng th√°i truy c·∫≠p</label>
                    <select id="packageAccessType" class="form-select">
                        <option value="open">‚úì ƒê√£ ƒëƒÉng k√≠</option>
                        <option value="register">üîí C·∫ßn ƒëƒÉng k√≠</option>
                        <option value="updating">üîÑ ƒêang c·∫≠p nh·∫≠t</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary btn-full">L∆∞u g√≥i ƒë·ªÅ</button>
            </form>
        </div>
    </div>

    <!-- Admin Modal -->
    <div id="adminModal" class="modal">
        <div class="modal-content modal-form">
            <button class="modal-close" onclick="closeAdminModal()">&times;</button>
            <h2>Th√™m Admin m·ªõi</h2>
            <form id="adminForm" onsubmit="saveNewAdmin(event)">
                <div class="form-group">
                    <label>T√™n Admin</label>
                    <input type="text" id="newAdminName" placeholder="H·ªç v√† t√™n" required>
                </div>
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="newAdminUsername" placeholder="T√™n ƒëƒÉng nh·∫≠p" required>
                </div>
                <div class="form-group">
                    <label>M·∫≠t kh·∫©u</label>
                    <input type="password" id="newAdminPassword" placeholder="M·∫≠t kh·∫©u" required>
                </div>
                <div class="form-group">
                    <label>Vai tr√≤</label>
                    <select id="newAdminRole" class="form-select">
                        <option value="editor">So·∫°n ƒë·ªÅ</option>
                        <option value="admin">Admin</option>
                        <option value="super">Super Admin</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary btn-full">Th√™m Admin</button>
                <div style="margin-top: 10px;">
                    <button type="button" class="btn btn-secondary btn-full" onclick="closeAdminModal()">H·ªßy</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Exam Preview Modal -->
    <div id="examPreviewModal" class="modal">
        <div class="modal-content modal-preview">
            <div class="preview-header">
                <h2>Xem tr∆∞·ªõc ƒë·ªÅ thi</h2>
                <button class="modal-close" onclick="closePreviewModal()">&times;</button>
            </div>
            <div id="previewContent" class="preview-body">
                <!-- Preview content will be rendered here -->
            </div>
            <div class="preview-footer">
                <button class="btn btn-secondary" onclick="closePreviewModal()">ƒê√≥ng</button>
            </div>
        </div>
    </div>

    <!-- Single Question Preview Modal -->
    <div id="singlePreviewModal" class="modal">
        <div class="modal-content modal-preview-single">
            <div class="preview-header">
                <h2 id="singlePreviewTitle">Xem tr∆∞·ªõc c√¢u h·ªèi</h2>
                <button class="modal-close" onclick="closeSinglePreviewModal()">&times;</button>
            </div>
            <div id="singlePreviewContent" class="preview-body">
                <!-- Single question preview will be rendered here -->
            </div>
            <div class="preview-footer">
                <button class="btn btn-secondary" onclick="closeSinglePreviewModal()">ƒê√≥ng</button>
            </div>
        </div>
    </div>

    <!-- User Detail Modal -->
    <div id="userDetailModal" class="modal">
        <div class="modal-content modal-form" style="max-width: 500px;">
            <button class="modal-close" onclick="closeUserDetailModal()">&times;</button>
            <h2>üë§ Th√¥ng tin h·ªçc sinh</h2>
            <input type="hidden" id="detailUserId">
            <div class="user-detail-info">
                <div class="detail-row">
                    <span class="detail-label">H·ªç t√™n:</span>
                    <span id="detailUserName" class="detail-value">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Email:</span>
                    <span id="detailUserEmail" class="detail-value">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Username:</span>
                    <span id="detailUserUsername" class="detail-value">-</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Ng√†y ƒëƒÉng k√Ω:</span>
                    <span id="detailUserDate" class="detail-value">-</span>
                </div>
            </div>
            <hr style="margin: 16px 0; border: none; border-top: 1px solid #e5e7eb;">
            <h3 style="margin-bottom: 12px; font-size: 16px;">üì¶ K√≠ch ho·∫°t g√≥i ƒë·ªÅ</h3>
            <div id="userPackagesList" class="user-packages-list">
                <!-- Package checkboxes will be rendered here -->
            </div>
            <button type="button" class="btn btn-primary btn-full" style="margin-top: 16px;"
                onclick="saveUserPackages()">L∆∞u thay ƒë·ªïi</button>
        </div>
    </div>

    <script src="admin.js"></script>
</body>

</html>